// This is an independent project of an individual developer. Dear PVS-Studio, please check it.
// PVS-Studio Static Code Analyzer for C, C++ and C#: http://www.viva64.com
#include "Definition.h"
#include "main.h"
#include "Display/Display.h"
#include "Display/Symbols.h"
#include "FlashDrive/FlashDrive.h"
#include "FPGA/FPGA.h"
#include "Hardware/FLASH.h"
#include "Hardware/Hardware.h"
#include "Hardware/RTC.h"
#include "Hardware/Sound.h"
#include "Menu/MenuDrawing.h"
#include "Menu/MenuFunctions.h"
#include "Panel/Panel.h"
#include "Utils/Dictionary.h"
#include "Utils/GlobalFunctions.h"
#include "Utils/Math.h"


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
extern Page mainPage;
extern void Func_Start(int key);          // 1 - Ì‡Ê‡ÚËÂ, 1 - ÓÚÔÛÒÍ‡ÌËÂ


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const       Button bResetSettings;                           ///< —≈–¬»— - —·ÓÒ Ì‡ÒÚÓÂÍ
        void       OnPress_ResetSettings(void);
static void           Draw_ResetSettings(void);
static const       Button bAutoSearch;                              ///< —≈–¬»— - œÓËÒÍ ÒË„Ì‡Î‡
static void        OnPress_AutoSearch(void);
static const        Page ppCalibrator;                              ///< —≈–¬»— -  ¿À»¡–¿“Œ–
static const       Choice cCalibrator_Calibrator;                   ///< —≈–¬»— -  ¿À»¡–¿“Œ– -  ‡ÎË·‡ÚÓ
static void      OnChanged_Calibrator_Calibrator(bool active);
static const       Button bCalibrator_Calibrate;                    ///< —≈–¬»— -  ¿À»¡–¿“Œ– -  ‡ÎË·Ó‚‡Ú¸
static bool       IsActive_Calibrator_Calibrate(void);
static void        OnPress_Calibrator_Calibrate(void);
#ifdef OLD_RECORDER
static const       Choice cRecorder;
static void      OnChanged_Recorder(bool active);
#else
static const       Page ppRecorder;                                 ///< —≈–¬»— - –≈√»—“–¿“Œ–
static const     SButton bRecorder_Exit;                            ///< —≈–¬»— - –≈√»—“–¿“Œ– - ¬˚ıÓ‰
static const     SButton bRecorder_SaveTo;                          ///< —≈–¬»— - –≈√»—“–¿“Œ– - —Óı‡ÌˇÚ¸ ‚...
static bool      IsActive_Recorder_SaveTo(void);
static void       OnPress_Recorder_SaveTo(void);
static void          Draw_Recorder_SaveTo(int, int);
static void          Draw_Recorder_SaveTo_RAM(int, int);
static void          Draw_Recorder_SaveTo_EXT(int, int);
static const     SButton bRecorder_Choice;                          ///< —≈–¬»— - –≈√»—“–¿“Œ– - ¬˚·Ó
static void       OnPress_Recorder_Choice(void);
static void          Draw_Recorder_Choice(int x, int y);
static const     SButton bRecorder_Cursor;                          ///< —≈–¬»— - –≈√»—“–¿“Œ– -  ÛÒÓ
static void       OnPress_Recorder_Cursor(void);
static void          Draw_Recorder_Cursor(int x, int y);
#endif
static const        Page ppFFT;                                     ///< —≈–¬»— - —œ≈ “–
static bool       IsActive_FFT(void);
static void        OnPress_FFT(void);
static const       Choice cFFT_View;                                ///< —≈–¬»— - —œ≈ “– - ŒÚÓ·‡ÊÂÌËÂ
static const       Choice cFFT_Scale;                               ///< —≈–¬»— - —œ≈ “– - ÿÍ‡Î‡
static const       Choice cFFT_Source;                              ///< —≈–¬»— - —œ≈ “– - »ÒÚÓ˜ÌËÍ
static const       Choice cFFT_Window;                              ///< —≈–¬»— - —œ≈ “– - ŒÍÌÓ
static const       Page pppFFT_Cursors;                             ///< —≈–¬»— - —œ≈ “– -  ”–—Œ–€
static bool       IsActive_FFT_Cursors(void);
static void       OnRegSet_FFT_Cursors(int angle);
static const      SButton bFFT_Cursors_Exit;                        ///< —≈–¬»— - —œ≈ “– -  ”–—Œ–€ - ¬˚ıÓ‰
static const      SButton bFFT_Cursors_Source;                      ///< —≈–¬»— - —œ≈ “– -  ”–—Œ–€ - »ÒÚÓ˜ÌËÍ
static void        OnPress_FFT_Cursors_Source(void);
static void           Draw_FFT_Cursors_Source(int x, int y);
static const       Choice cFFT_Range;                               ///< —≈–¬»— - —œ≈ “– - ƒË‡Ô‡ÁÓÌ
static bool       IsActive_FFT_Range(void);
static const        Page ppFunction;                                ///< —≈–¬»— - ‘”Õ ÷»ﬂ
static bool       IsActive_Function(void);
static void        OnPress_Function(void);
static void       OnRegSet_Function(int delta);
static const      SButton bFunction_Exit;                           ///< —≈–¬»— - ‘”Õ ÷»ﬂ - ¬˚ıÓ‰
static const      SButton bFunction_Screen;                         ///< —≈–¬»— - ‘”Õ ÷»ﬂ - ›Í‡Ì
static void        OnPress_Function_Screen(void);
static void           Draw_Function_Screen(int x, int y);
static void           Draw_Function_Screen_Disable(int x, int y);
static void           Draw_Function_Screen_Separate(int x, int y);
static void           Draw_Function_Screen_Together(int x, int y);
static const      SButton bFunction_Type;                           ///< —≈–¬»— - ‘”Õ ÷»ﬂ - ¬Ë‰
static void        OnPress_Function_Type(void);
static void           Draw_Function_Type(int x, int y);
static void           Draw_Function_Type_Sum(int x, int y);
static void           Draw_Function_Type_Mul(int x, int y);
static const      SButton bFunction_ModeRegSet;                     ///< —≈–¬»— - ‘”Õ ÷»ﬂ - –ÂÊËÏ Û˜ÍË ”—“¿ÕŒ¬ ¿
static void        OnPress_Function_ModeRegSet(void);
static void           Draw_Function_ModeRegSet(int x, int y);
static void           Draw_Function_ModeRegSet_Range(int x, int y);
static void           Draw_Function_ModeRegSet_RShift(int x, int y);
static const      SButton bFunction_RangeA;                         ///< —≈–¬»— - ‘”Õ ÷»ﬂ - Ã‡Ò¯Ú‡· 1-„Ó Í‡Ì‡Î‡
static void        OnPress_Function_RangeA(void);
static void           Draw_Function_RangeA(int x, int y);
static const      SButton bFunction_RangeB;                         ///< —≈–¬»— - ‘”Õ ÷»ﬂ - Ã‡Ò¯Ú‡· 2-„Ó Í‡Ì‡Î‡
static void        OnPress_Function_RangeB(void);
static void           Draw_Function_RangeB(int x, int y);
static const        Page ppEthernet;                                ///< —≈–¬»— - ETHERNET
static const      Choice cEthernet_Ethernet;                        ///< —≈–¬»— - ETHERNET - Ethernet
static void     OnChanged_Ethernet_Settings(bool active);
static const  IPaddress ipEthernet_IP;                              ///< —≈–¬»— - ETHERNET - IP ‡‰ÂÒ
static const  IPaddress ipEthernet_NetMask;                         ///< —≈–¬»— - ETHERNET - Ã‡ÒÍ‡ ÔÓ‰ÒÂÚË
static const  IPaddress ipEthernet_Gateway;                         ///< —≈–¬»— - ETHERNET - ÿÎ˛Á
static const MACaddress ipEthernet_MAC;                             ///< —≈–¬»— - ETHERNET - MAC ‡‰ÂÒ
static const       Page ppSound;                                    ///< —≈–¬»— - «¬” 
static const      Choice cSound_Enable;                             ///< —≈–¬»— - «¬”  - «‚ÛÍ
static const    Governor gSound_Volume;                             ///< —≈–¬»— - «¬”  - √ÓÏÍÓÒÚ¸
static const       Page ppRTC;                                     ///< —≈–¬»— - ¬–≈Ãﬂ
static const        Time tRTC_Time;                                ///< —≈–¬»— - ¬–≈Ãﬂ - ¬ÂÏˇ
static const    Governor tRTC_Correction;                          ///< —≈–¬»— - ¬–≈Ãﬂ -  ÓÂÍˆËˇ
static void     OnChanged_Time_Correction(void);
static const      Choice cLanguage;                                 ///< —≈–¬»— - ﬂ«€ 
static const       Page ppInformation;                              ///< —≈–¬»— - »Õ‘Œ–Ã¿÷»ﬂ
static void       OnPress_Information(void);
static void   Information_Draw(void);
static const     SButton bInformation_Exit;                         ///< —≈–¬»— - »Õ‘Œ–Ã¿÷»ﬂ - ¬˚ıÓ‰
static void       OnPress_Information_Exit(void);


// —≈–¬»— ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const Page pService =
{
    Item_Page, &mainPage, 0,
    {
        "—≈–¬»—", "SERVICE",
        "ƒÓÔÓÎÌËÚÂÎ¸Ì˚Â Ì‡ÒÚÓÈÍË, Í‡ÎË·Ó‚Í‡, ÔÓËÒÍ ÒË„Ì‡Î‡, Ï‡ÚÂÏ‡ÚË˜ÂÒÍËÂ ÙÛÌÍˆËË",
        "Additional settings, calibration, signal search, mathematical functions"
    },
    Page_Service,
    {
        (void *)&bResetSettings,    // —≈–¬»— - —·ÓÒ Ì‡ÒÚÓÂÍ
        (void *)&bAutoSearch,       // —≈–¬»— - œÓËÒÍ ÒË„Ì‡Î‡
        (void *)&ppCalibrator,      // —≈–¬»— -  ¿À»¡–¿“Œ–
#ifdef OLD_RECORDER
        (void *)&cRecorder,         // —≈–¬»— - –Â„ËÒÚ‡ÚÓ
#else
        (void *)&ppRecorder,        // —≈–¬»— - –≈√»—“–¿“Œ–
#endif
        (void *)&ppFFT,             // —≈–¬»— - —œ≈ “–
        (void *)&ppFunction,        // —≈–¬»— - ‘”Õ ÷»ﬂ
        (void *)&ppEthernet,        // —≈–¬»— - ETHERNET
        (void *)&ppSound,           // —≈–¬»— - «¬” 
        (void *)&ppRTC,             // —≈–¬»— - ¬–≈Ãﬂ
        (void *)&cLanguage,         // —≈–¬»— - ﬂÁ˚Í
        (void *)&ppInformation      // —≈–¬»— - »Õ‘Œ–Ã¿÷»ﬂ
    }
};

// —≈–¬»— - —·ÓÒ Ì‡ÒÚÓÂÍ ---------------------------------------------------------------------------------------------------------------------------
static const Button bResetSettings =
{
    Item_Button, &pService, 0,
    {
        "—·ÓÒ Ì‡ÒÚÓÂÍ", "Reset settings",
        "—·ÓÒ Ì‡ÒÚÓÂÍ Ì‡ Ì‡ÒÚÓÈÍË ÔÓ ÛÏÓÎ˜‡ÌË˛",
        "Reset to default settings"
    },
    OnPress_ResetSettings
};

void OnPress_ResetSettings(void)
{
    Panel_Disable();
    Display_SetDrawMode(DrawMode_Hand, Draw_ResetSettings);

    if (Panel_WaitPressingButton() == B_Start)
    {
        Settings_Load(true);
    }

    Display_SetDrawMode(DrawMode_Auto, 0);
    Panel_Enable();
    Func_Start(1);
}

static void Draw_ResetSettings(void)
{
    Painter_BeginScene(gColorBack);

    Painter_DrawTextInRectWithTransfersC(30, 110, 300, 200, "œÓ‰Ú‚Â‰ËÚÂ Ò·ÓÒ Ì‡ÒÚÓÂÍ Ì‡Ê‡ÚËÂÏ ÍÌÓÔÍË œ”— /—“Œœ.\n"
                                                         "Õ‡ÊÏËÚÂ Î˛·Û˛ ‰Û„Û˛ ÍÌÓÔÍÛ, ÂÒÎË Ò·ÓÒ ÌÂ ÌÛÊÂÌ.", gColorFill);

    Painter_EndScene();
}

// —≈–¬»— - œÓËÒÍ ÒË„Ì‡Î‡ ----------------------------------------------------------------------------------------------------------------------------
static const Button bAutoSearch =
{
    Item_Button, &pService, 0,
    {
        "œÓËÒÍ ÒË„Ì‡Î‡", "Find signal",
        "”ÒÚ‡Ì‡‚ÎË‚‡ÂÚ ÓÔÚËÏ‡Î¸Ì˚Â ÛÒÚ‡ÌÓ‚ÍË ÓÒˆËÎÎÓ„‡Ù‡ ‰Îˇ ÒË„Ì‡Î‡ ‚ Í‡Ì‡ÎÂ 1",
        "Sets optimal settings for the oscilloscope signal on channel 1"
    },
    OnPress_AutoSearch
};

static void OnPress_AutoSearch(void)
{
    FPGA_NEED_AUTO_FIND = 1;
};


// —≈–¬»— -  ¿À»¡–¿“Œ– ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page ppCalibrator =
{
    Item_Page, &pService, 0,
    {
        " ¿À»¡–¿“Œ–", "CALIBRATOR",
        "”Ô‡‚ÎÂÌËÂÏ Í‡ÎË·‡ÚÓÓÏ Ë Í‡ÎË·Ó‚Í‡ ÓÒˆËÎÎÓ„‡Ù‡",
        "Control of the calibrator and calibration of an oscillograph"
    },
    Page_Service_Calibrator,
    {
        (void *)&cCalibrator_Calibrator,    // —≈–¬»— -  ¿À»¡–¿“Œ– -  ‡ÎË·‡ÚÓ
        (void *)&bCalibrator_Calibrate      // —≈–¬»— -  ¿À»¡–¿“Œ– -  ‡ÎË·Ó‚‡Ú¸
    }
};


// —≈–¬»— -  ¿À»¡–¿“Œ– -  ‡ÎË·‡ÚÓ ------------------------------------------------------------------------------------------------------------------
static const Choice cCalibrator_Calibrator =
{
    Item_Choice, &ppCalibrator, 0,
    {
        " ‡ÎË·‡ÚÓ",   "Calibrator",
        "–ÂÊËÏ ‡·ÓÚ˚ Í‡ÎË·‡ÚÓ‡",
        "Mode of operation of the calibrator"
    },
    {
        {"œÂÂÏ",       "DC"},
        {"+4V",         "+4V"},
        {"0V",          "0V"}
    },
    (int8 *)&CALIBRATOR_MODE, OnChanged_Calibrator_Calibrator
};

static void OnChanged_Calibrator_Calibrator(bool active)
{
    FPGA_SetCalibratorMode(CALIBRATOR_MODE);
}

// —≈–¬»— -  ¿À»¡–¿“Œ– -  ‡ÎË·Ó‚‡Ú¸ -----------------------------------------------------------------------------------------------------------------
static const Button bCalibrator_Calibrate =
{
    Item_Button, &ppCalibrator, IsActive_Calibrator_Calibrate,
    {
        " ‡ÎË·Ó‚‡Ú¸", "Calibrate",
        "«‡ÔÛÒÍ ÔÓˆÂ‰Û˚ Í‡ÎË·Ó‚ÍË",
        "Running the calibration procedure"
    },
    OnPress_Calibrator_Calibrate
};

static bool IsActive_Calibrator_Calibrate(void)
{
    return !(SET_CALIBR_MODE_A == CalibrationMode_Disable && CALIBR_MODE_B == CalibrationMode_Disable);
}

static void OnPress_Calibrator_Calibrate(void)
{
    gStateFPGA.needCalibration = true;
}

#ifdef OLD_RECORDER

// —≈–¬»— - –Â„ËÒÚ‡ÚÓ ------------------------------------------------------------------------------------------------------------------------------
static const Choice cRecorder =
{
    Item_Choice, &pService, 0,
    {
        "–Â„ËÒÚ‡ÚÓ", "Recorder",
        "¬ÍÎ˛˜‡ÂÚ/‚˚ÍÎ˛˜‡ÂÚ ÂÊËÏ Â„ËÒÚ‡ÚÓ‡. ›ÚÓÚ ÂÊËÏ ‰ÓÒÚÛÔÂÌ Ì‡ ‡Á‚∏ÚÍ‡ı 50 ÏÒ/‰ÂÎ Ë ·ÓÎÂÂ ÏÂ‰ÎÂÌÌ˚ı.",
        "Turn on/off recorder mode. This mode is available for scanning 20ms/div and slower."
    },
    {
        {DISABLE_RU, DISABLE_EN},
        {ENABLE_RU, ENABLE_EN}
    },
    (int8 *)&RECORDER_MODE, OnChanged_Recorder
};

static void OnChanged_Recorder(bool active)
{
    FPGA_EnableRecorderMode(RECORDER_MODE);
}

#else

// C≈–¬»— - –≈√»—“–¿“Œ– //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page ppRecorder =
{
    Item_Page, &pService, 0,
    {
        "–≈√»—“–¿“Œ–", "RECORDER",
        "«‡ÔËÒ¸ Ë ‚ÓÒÔÓËÁ‚Â‰ÂÌËÂ ‚ıÓ‰Ì˚ı ÒË„Ì‡ÎÓ‚",
        "Recording and playback of input signals"
    },
    PageSB_Service_Recorder,
    {
        (void *)&bRecorder_Exit,
        (void *)&bRecorder_SaveTo,
        (void *)&bRecorder_Choice,
        (void *)&bRecorder_Cursor
    },
    true
};

// —≈–¬»— - –≈√»—“–¿“Œ– - ¬˚ıÓ‰ ----------------------------------------------------------------------------------------------------------------------
static const SButton bRecorder_Exit =
{
    Item_SmallButton, &ppRecorder, 0,
    {
        "¬˚ıÓ‰", "Exit",
        "¬˚ıÓ‰ ËÁ ÂÊËÏ‡ Â„ËÒÚ‡ÚÓ‡",
        "Exit registrator mode"
    },
    OnPressSB_Exit,
    DrawSB_Exit
};

// —≈–¬»— - –≈√»—“–¿“Œ– - —Óı‡ÌˇÚ¸ ‚ ... ------------------------------------------------------------------------------------------------------------
static const SButton bRecorder_SaveTo =
{
    Item_SmallButton, &ppRecorder, IsActive_Recorder_SaveTo,
    {
        "—Óı‡ÌˇÚ¸ ‚ ...", "Save in ...",
        "¬˚·Ó ÏÂÒÚ‡ ı‡ÌÂÌËˇ ‰‡ÌÌ˚ı",
        "Selecting a storage location"
    },
    OnPress_Recorder_SaveTo,
    Draw_Recorder_SaveTo,
    {
        {Draw_Recorder_SaveTo_RAM, "‰‡ÌÌ˚Â ÒÓı‡Ìˇ˛ÚÒˇ ‚Ó ‚ÌÛÚÂÌÌ˛˛ Ô‡ÏˇÚ¸", "data is stored in the internal memory"},
        {Draw_Recorder_SaveTo_EXT, "‰‡ÌÌ˚Â ÒÓı‡Ìˇ˛ÚÒˇ Ì‡ ‚ÌÂ¯ÌÂÏ «”", "data is stored in the data storage"}
    }
};

static bool IsActive_Recorder_SaveTo(void)
{
    return FDRIVE_IS_CONNECTED;
}

static void OnPress_Recorder_SaveTo(void)
{
    CircleIncreaseInt8((int8*)(&REC_PLACE_OF_SAVING), 0, PlaceOfSaving_Number - 1);
}

static void Draw_Recorder_SaveTo(int x, int y)
{
    static const pFuncVII funcs[PlaceOfSaving_Number] =
    {
        Draw_Recorder_SaveTo_RAM, Draw_Recorder_SaveTo_EXT
    };

    funcs[REC_PLACE_OF_SAVING](x, y);
}

static void Draw_Recorder_SaveTo_RAM(int x, int y)
{
    Painter_SetFont(TypeFont_UGO2);
    Painter_Draw4SymbolsInRect(x + 2, y + 1, SYMBOL_ROM);
    Painter_SetFont(TypeFont_8);
}

static void Draw_Recorder_SaveTo_EXT(int x, int y)
{
    Painter_SetFont(TypeFont_UGO2);
    Painter_Draw4SymbolsInRect(x + 2, y + 1, SYMBOL_FLASH_DRIVE_BIG);
    Painter_SetFont(TypeFont_8);
}

// —≈–¬»— - –≈√»—“–¿“Œ– - ¬˚·Ó ----------------------------------------------------------------------------------------------------------------------
static const SButton bRecorder_Choice =
{
    Item_SmallButton, &ppRecorder, 0,
    {
        "¬˚·Ó", "Choice",
        "¬˚·Ó ÒË„Ì‡Î‡ ‰Îˇ ÔÓÒÏÓÚ‡",
        "Select signal to view"
    },
    OnPress_Recorder_Choice,
    Draw_Recorder_Choice
};

static void OnPress_Recorder_Choice(void)
{

}

static void Draw_Recorder_Choice(int x, int y)
{
    Painter_SetFont(TypeFont_UGO2);
    Painter_Draw4SymbolsInRect(x + 1, y, SYMBOL_FOLDER);
    Painter_SetFont(TypeFont_8);
}

// —≈–¬»— - –≈√»—“–¿“Œ– -  ÛÒÓ ---------------------------------------------------------------------------------------------------------------------
static const SButton bRecorder_Cursor =
{
    Item_SmallButton, &ppRecorder, 0,
    {
        " ÛÒÓ", "Cursors",
        "¬˚·Ó ÍÛÒÓ‡",
        "Cursor selection"
    },
    OnPress_Recorder_Cursor,
    Draw_Recorder_Cursor
};

static void OnPress_Recorder_Cursor(void)
{
    CircleIncreaseInt8(&REC_NUM_CURSOR, 0, 1);
}

static void Draw_Recorder_Cursor(int x, int y)
{
    Painter_DrawText(x + 8, y + 5, REC_NUM_CURSOR ? "2" : "1");
}

//----------------------------------------------------------------------------------------------------------------------------------------------------



#endif


// —≈–¬»— - —œ≈ “– ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page ppFFT =
{
    Item_Page, &pService, IsActive_FFT,
    {
        "—œ≈ “–", "SPECTRUM",
        "ŒÚÓ·‡ÊÂÌËÂ ÒÔÂÍÚ‡ ‚ıÓ‰ÌÓ„Ó ÒË„Ì‡Î‡",
        "Mapping the input signal spectrum"
    },
    Page_Service_FFT,
    {
        (void *)&cFFT_View,         // —≈–¬»— - —œ≈ “– - ŒÚÓ·‡ÊÂÌËÂ
        (void *)&cFFT_Scale,        // —≈–¬»— - —œ≈ “– - ÿÍ‡Î‡
        (void *)&cFFT_Source,       // —≈–¬»— - —œ≈ “– - »ÒÚÓ˜ÌËÍ
        (void *)&cFFT_Window,       // —≈–¬»— - —œ≈ “– - ŒÍÌÓ 
        (void *)&pppFFT_Cursors,    // —≈–¬»— - —œ≈ “– -  ”–—Œ–€
        (void *)&cFFT_Range         // —≈–¬»— - —œ≈ “– - ƒË‡Ô‡ÁÓÌ
    },
    false, OnPress_FFT
};

static bool IsActive_FFT(void)
{
    return !FUNC_ENABLED;
}

static void OnPress_FFT(void)
{
    if (!IsActive_FFT())
    {
        Display_ShowWarning(ImpossibleEnableFFT);
    }
}

// —≈–¬»— - —œ≈ “– - ŒÚÓ·‡ÊÂÌËÂ ---------------------------------------------------------------------------------------------------------------------
static const Choice cFFT_View =
{
    Item_Choice, &ppFFT, 0,
    {
        "ŒÚÓ·‡ÊÂÌËÂ", "Display",
        "¬ÍÎ˛˜‡ÂÚ Ë ‚˚ÍÎ˛˜‡ÂÚ ÓÚÓ·‡ÊÂÌËÂ ÒÔÂÍÚ‡",
        "Enables or disables the display of the spectrum"
    },
    {
        {DISABLE_RU,    DISABLE_EN},
        {ENABLE_RU,     ENABLE_EN}
    },
    (int8 *)&FFT_ENABLED
};


// —≈–¬»— - —œ≈ “– - ÿÍ‡Î‡ ---------------------------------------------------------------------------------------------------------------------------
static const Choice cFFT_Scale =
{
    Item_Choice, &ppFFT, 0,
    {
        "ÿÍ‡Î‡",        "Scale",
        "«‡‰‡∏Ú Ï‡Ò¯Ú‡· ‚˚‚Ó‰‡ ÒÔÂÍÚ‡ - ÎËÌÂÈÌ˚È ËÎË ÎÓ„‡ËÙÏË˜ÂÒÍËÈ",
        "Sets the scale of the output spectrum - linear or logarithmic"
    },
    {
        {"ÀÓ„‡ËÙÏ",    "Log"},
        {"ÀËÌÂÈÌ‡ˇ",    "Linear"}
    },
    (int8 *)&SCALE_FFT
};

// —≈–¬»— - —œ≈ “– - »ÒÚÓ˜ÌËÍ ------------------------------------------------------------------------------------------------------------------------
static const Choice cFFT_Source =
{
    Item_Choice, &ppFFT, 0,
    {
        "»ÒÚÓ˜ÌËÍ",     "Source",
        "¬˚·Ó ËÒÚÓ˜ÌËÍ‡ ‰Îˇ ‡Ò˜∏Ú‡ ÒÔÂÍÚ‡",
        "Selecting the source for the calculation of the spectrum"
    },
    {
        {" ‡Ì‡Î 1",     "Channel 1"},
        {" ‡Ì‡Î 2",     "Channel 2"},
        {" ‡Ì‡Î 1 + 2", "Channel 1 + 2"}
    },
    (int8 *)&SOURCE_FFT
};

// —≈–¬»— - —œ≈ “– - ŒÍÌÓ ----------------------------------------------------------------------------------------------------------------------------
static const Choice cFFT_Window =
{
    Item_Choice, &ppFFT, 0,
    {
        "ŒÍÌÓ",         "Window",
        "«‡‰‡∏Ú ÓÍÌÓ ‰Îˇ ‡Ò˜∏Ú‡ ÒÔÂÍÚ‡",
        "Sets the window to calculate the spectrum"
    },
    {
        {"œˇÏÓÛ„ÓÎ¸Ì", "Rectangle"},
        {"’˝ÏÏËÌ„‡",    "Hamming"},
        {"¡Î˝ÍÏÂÌ‡",    "Blackman"},
        {"’‡ÌÌ‡",       "Hann"}
    },
    (int8 *)&WINDOW_FFT
};

// —≈–¬»— - —œ≈ “– -  ”–—Œ–€ /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page pppFFT_Cursors =
{
    Item_Page, &ppFFT, IsActive_FFT_Cursors,
    {
        " ”–—Œ–€", "CURSORS",
        "¬ÍÎ˛˜‡ÂÚ ÍÛÒÓ˚ ‰Îˇ ËÁÏÂÂÌËˇ Ô‡‡ÏÂÚÓ‚ ÒÔÂÍÚ‡",
        "Includes cursors to measure the parameters of the spectrum"
    },
    PageSB_Service_FFT_Cursors,
    {
        (void *)&bFFT_Cursors_Exit,     // —≈–¬»— - —œ≈ “– -  ”–—Œ–€ - ¬˚ıÓ‰
        (void *)&bFFT_Cursors_Source,   // —≈–¬»— - —œ≈ “– -  ”–—Œ–€ - »ÒÚÓ˜ÌËÍ
        (void *)0,
        (void *)0,
        (void *)0,
        (void *)0
    },
    true, 0, 0, OnRegSet_FFT_Cursors
};

static bool IsActive_FFT_Cursors(void)
{
    return FFT_ENABLED;
}

static void OnRegSet_FFT_Cursors(int angle)
{
    POS_MATH_CUR(MATH_CURRENT_CUR) += (uint8)angle;
    Sound_RegulatorShiftRotate();
}


// —≈–¬»— - —œ≈ “– -  ”–—Œ–€ - ¬˚ıÓ‰ -----------------------------------------------------------------------------------------------------------------
static const SButton bFFT_Cursors_Exit =
{
    Item_SmallButton, &pppFFT_Cursors,
    COMMON_BEGIN_SB_EXIT,
    OnPressSB_Exit,
    DrawSB_Exit
};

// —≈–¬»— - —œ≈ “– -  ”–—Œ–€ - »ÒÚÓ˜ÌËÍ --------------------------------------------------------------------------------------------------------------
static const SButton bFFT_Cursors_Source =
{
    Item_SmallButton, &pppFFT_Cursors, 0,
    {
        "»ÒÚÓ˜ÌËÍ", "Source",
        "¬˚·Ó ËÒÚÓ˜ÌËÍ‡ ‰Îˇ ‡Ò˜∏Ú‡ ÒÔÂÍÚ‡",
        "Source choice for calculation of a range"
    },
    OnPress_FFT_Cursors_Source,
    Draw_FFT_Cursors_Source
};

static void OnPress_FFT_Cursors_Source(void)
{
    MATH_CURRENT_CUR = (MATH_CURRENT_CUR + 1) % 2;
}

static void Draw_FFT_Cursors_Source(int x, int y)
{
    Painter_DrawText(x + 7, y + 5, MATH_CURRENT_CUR_IS_0 ? "1" : "2");
}

// —≈–¬»— - —œ≈ “– - ƒË‡Ô‡ÁÓÌ ------------------------------------------------------------------------------------------------------------------------
static const Choice cFFT_Range =
{
    Item_Choice, &ppFFT, IsActive_FFT_Range,
    {
        "ƒË‡Ô‡ÁÓÌ", "Range",
        "«‰ÂÒ¸ ÏÓÊÌÓ Á‡‰‡Ú¸ ÔÂ‰ÂÎ Ì‡·Î˛‰ÂÌËˇ Á‡ ÏÓ˘ÌÓÒÚ¸˛ ÒÔÂÍÚ‡",
        "Here you can set the limit of monitoring the power spectrum"
    },

    {
        {"-40‰¡",   "-40dB"},
        {"-60‰¡",   "-60dB"},
        {"-80‰¡",   "-80dB"}
    },
    (int8 *)&MAX_DB_FFT
};

static bool IsActive_FFT_Range(void)
{
    return SCALE_FFT_LOG;
}

// —≈–¬»— - ‘”Õ ÷»ﬂ //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page ppFunction =
{
    Item_Page, &pService, IsActive_Function,
    {
        "‘”Õ ÷»ﬂ", "FUNCTION",
        "”ÒÚ‡ÌÓ‚Í‡ Ë ‚˚·Ó Ï‡ÚÂÏ‡ÚË˜ÂÒÍÓÈ ÙÛÌÍˆËË - ÒÎÓÊÂÌËˇ ËÎË ÛÏÌÓÊÂÌËˇ",
        "Installation and selection of mathematical functions - addition or multiplication"
    },
    PageSB_Service_Function,
    {
        (void *)&bFunction_Exit,        // —≈–¬»— - ‘”Õ ÷»ﬂ - ¬˚ıÓ‰
        (void *)&bFunction_Screen,      // —≈–¬»— - ‘”Õ ÷»ﬂ - ›Í‡Ì
        (void *)&bFunction_Type,        // —≈–¬»— - ‘”Õ ÷»ﬂ - ¬Ë‰
        (void *)&bFunction_ModeRegSet,  // —≈–¬»— - ‘”Õ ÷»ﬂ - –ÂÊËÏ Û˜ÍË ”—“¿ÕŒ¬ ¿
        (void *)&bFunction_RangeA,      // —≈–¬»— - ‘”Õ ÷»ﬂ - Ã‡Ò¯Ú‡· 1-„Ó Í‡Ì‡Î‡
        (void *)&bFunction_RangeB
    },
    true, OnPress_Function, 0, OnRegSet_Function
};

static bool IsActive_Function(void)
{
    return !FFT_ENABLED;
}

static void OnPress_Function(void)
{
    if (FFT_ENABLED)
    {
        Display_ShowWarning(ImpossibleEnableMathFunction);
    }
}

static void OnRegSet_Function(int delta)
{
    if (!FUNC_ENABLED)
    {
        return;
    }

    if (MATH_MODE_REG_SET_IS_RSHIFT)
    {
        uint16 prevRShift = SET_RSHIFT_MATH;
        uint16 rShift = prevRShift;
        if (delta > 0)
        {
            if (rShift < RShiftMax)
            {
                rShift += 4 * STEP_RSHIFT;
                LIMIT_ABOVE(rShift, RShiftMax);
                if (prevRShift < RShiftZero && rShift > RShiftZero)
                {
                    rShift = RShiftZero;
                }
                Sound_RegulatorShiftRotate();
                SET_RSHIFT_MATH = rShift;
            }
        }
        else if (delta < 0)
        {
            if (rShift > RShiftMin)
            {
                rShift -= 4 * STEP_RSHIFT;
                LIMIT_BELOW(rShift, RShiftMin);
                if (prevRShift > RShiftZero && rShift < RShiftZero)
                {
                    rShift = RShiftZero;
                }
                Sound_RegulatorShiftRotate();
                SET_RSHIFT_MATH = rShift;
            }
        }
    }
    if (MATH_MODE_REG_SET_IS_RANGE)
    {
        static int sum = 0;
        sum -= delta;

        float rShiftAbs = RSHIFT_2_ABS(SET_RSHIFT_MATH, SET_RANGE_MATH);

        if (sum > 2)
        {
            if (SET_RANGE_MATH < RangeSize - 1)
            {
                SET_RANGE_MATH++;
                SET_RSHIFT_MATH = (int16)Math_RShift2Rel(rShiftAbs, SET_RANGE_MATH);
                Sound_RegulatorSwitchRotate();
            }
            sum = 0;
        }
        else if (sum < -2)
        {
            if (SET_RANGE_MATH > 0)
            {
                SET_RANGE_MATH--;
                SET_RSHIFT_MATH = (int16)Math_RShift2Rel(rShiftAbs, SET_RANGE_MATH);
                Sound_RegulatorSwitchRotate();
            }
            sum = 0;
        }
    }
}

// —≈–¬»— - ‘”Õ ÷»ﬂ - ¬˚ıÓ‰ --------------------------------------------------------------------------------------------------------------------------
static const SButton bFunction_Exit =
{
    Item_SmallButton, &ppFunction, 0,
    {
        "¬˚ıÓ‰", "Exit",
        " ÌÓÔÍ‡ ‰Îˇ ‚˚ıÓ‰‡ ‚ ÔÂ‰˚‰Û˘ÂÂ ÏÂÌ˛",
        "Button to return to the previous menu"
    },
    0,
    DrawSB_Exit
};

// —≈–¬»— - ‘”Õ ÷»ﬂ - ›Í‡Ì --------------------------------------------------------------------------------------------------------------------------
static const SButton bFunction_Screen =
{
    Item_SmallButton, &ppFunction, 0,
    {
        "›Í‡Ì", "Display",
        "¬˚·Ë‡ÂÚ ÂÊËÏ ÓÚÓ·‡ÊÂÌËˇ Ï‡ÚÂÏ‡ÚË˜ÂÒÍÓ„Ó ÒË„Ì‡Î‡",
        "Chooses the mode of display of a mathematical signal"
    },
    OnPress_Function_Screen,
    Draw_Function_Screen,
    {
        {Draw_Function_Screen_Disable,  "¬˚‚Ó‰ Ï‡ÚÂÏ‡ÚË˜ÂÒÍÓÈ ÙÛÌÍˆËË ÓÚÍÎ˛˜∏Ì",                        "The conclusion of mathematical function is disconnected"},
        {Draw_Function_Screen_Separate, "—Ë„Ì‡Î˚ Ë Ï‡ÚÂÏ‡ÚË˜ÂÒÍ‡ˇ ÙÛÌÍˆËˇ ‚˚‚Ó‰ˇÚÒˇ ‚ ‡ÁÌ˚ı ÓÍÌ‡ı",    "Signals and mathematical function are removed in different windows"},
        {Draw_Function_Screen_Together, "—Ë„Ì‡Î˚ Ë Ï‡ÚÂÏ‡ÚË˜ÂÒÍ‡ˇ ÙÛÌÍˆËˇ ‚˚‚Ó‰ˇÚÒˇ ‚ Ó‰ÌÓÏ ÓÍÌÂ",      "Signals and mathematical function are removed in one window"}
    }
};

static void OnPress_Function_Screen(void)
{
    if (FFT_ENABLED)
    {
        Display_ShowWarning(ImpossibleEnableMathFunction);
    }
    else
    {
        CircleIncreaseInt8((int8 *)&FUNC_MODE_DRAW, 0, 2);
    }
}

static void Draw_Function_Screen(int x, int y)
{
    const pFuncVII funcs[3] =
    {
        Draw_Function_Screen_Disable,
        Draw_Function_Screen_Separate,
        Draw_Function_Screen_Together
    };
    funcs[FUNC_MODE_DRAW](x, y);
}

static void Draw_Function_Screen_Disable(int x, int y)
{
    Painter_DrawText(x + 2 + (LANG_EN ? 2 : 0), y + 5, DICT(DDis));
}

static void Draw_Function_Screen_Separate(int x, int y)
{
    Painter_DrawRectangle(x + 3, y + 5, 13, 9);
    Painter_DrawHLine(y + 9, x + 3, x + 16);
    Painter_DrawHLine(y + 10, x + 3, x + 16);
}

static void Draw_Function_Screen_Together(int x, int y)
{
    Painter_DrawRectangle(x + 3, y + 5, 13, 9);
}

// —≈–¬»— - ‘”Õ ÷»ﬂ - ¬Ë‰ ----------------------------------------------------------------------------------------------------------------------------
static const SButton bFunction_Type =
{
    Item_SmallButton, &ppFunction, 0,
    {
        "¬Ë‰", "Type",
        "¬˚·Ó Ï‡ÚÂÏ‡ÚË˜ÂÒÍÓÈ ÙÛÌÍˆËË",
        "Choice of mathematical function"
    },
    OnPress_Function_Type,
    Draw_Function_Type,
    {
        { Draw_Function_Type_Sum,      "—ÎÓÊÂÌËÂ",     "Addition"       },
        { Draw_Function_Type_Mul,      "”ÏÌÓÊÂÌËÂ",    "Multiplication" }
    }
};

static void OnPress_Function_Type(void)
{
    CircleIncreaseInt8((int8 *)&MATH_FUNC, 0, 1);
}

static void Draw_Function_Type(int x, int y)
{
    const pFuncVII funcs[2] = {Draw_Function_Type_Sum, Draw_Function_Type_Mul};
    funcs[MATH_FUNC](x, y);
}

static void Draw_Function_Type_Sum(int x, int y)
{
    Painter_DrawHLine(y + 9, x + 4, x + 14);
    Painter_DrawVLine(x + 9, y + 4, y + 14);
}

static void Draw_Function_Type_Mul(int x, int y)
{
    Painter_SetFont(TypeFont_UGO2);
    Painter_Draw4SymbolsInRect(x + 4, y + 3, SYMBOL_MATH_FUNC_MUL);
    Painter_SetFont(TypeFont_8);
}


// —≈–¬»— - ‘”Õ ÷»ﬂ - –ÂÊËÏ Û˜ÍË ”—“¿ÕŒ¬ ¿ ----------------------------------------------------------------------------------------------------------
static const SButton bFunction_ModeRegSet =
{
    Item_SmallButton, &ppFunction, 0,
    {
        "–ÂÊËÏ Û˜ÍË ”—“¿ÕŒ¬ ¿", "Mode regulator SET",
        "¬˚·Ó ÂÊËÏ‡ Û˜ÍË ”—“¿ÕŒ¬ ¿ - ÛÔ‡‚ÎÂÌËÂ Ï‡Ò¯Ú‡·ÓÏ ËÎË ÒÏÂ˘ÂÌËÂÏ",
        "Choice mode regulcator ”—“¿ÕŒ¬ ¿ - management of scale or shift"
    },
    OnPress_Function_ModeRegSet,
    Draw_Function_ModeRegSet,
    {
        {Draw_Function_ModeRegSet_Range,  "”Ô‡‚ÎÂÌËÂ Ï‡Ò¯Ú‡·ÓÏ", "Management of scale"},
        {Draw_Function_ModeRegSet_RShift, "”Ô‡‚ÎÂÌËÂ ÒÏÂ˘ÂÌËÂÏ", "Management of shift"}
    }
};

static void OnPress_Function_ModeRegSet(void)
{
    CircleIncreaseInt8((int8 *)&MATH_MODE_REG_SET, 0, 1);
}

static void Draw_Function_ModeRegSet(int x, int y)
{
    static const pFuncVII funcs[2] = {Draw_Function_ModeRegSet_Range, Draw_Function_ModeRegSet_RShift};
    funcs[MATH_MODE_REG_SET](x, y);
}

static void Draw_Function_ModeRegSet_Range(int x, int y)
{
    Painter_DrawChar(x + 7, y + 5, LANG_RU ? 'M' : 'S');
}

static void Draw_Function_ModeRegSet_RShift(int x, int y)
{
    Painter_DrawText(x + 5 - (LANG_EN ? 3 : 0), y + 5, DICT(DShift));
}

// —≈–¬»— - ‘”Õ ÷»ﬂ - Ã‡Ò¯Ú‡· 1-„Ó Í‡Ì‡Î‡ ------------------------------------------------------------------------------------------------------------
static const SButton bFunction_RangeA =
{
    Item_SmallButton, &ppFunction, 0,
    {
        "Ã‡Ò¯Ú‡· 1-„Ó Í‡Ì‡Î‡", "Scale of the 1st channel",
        "»ÒÔÓÎ¸ÁÛÂÚ Ï‡Ò¯Ú‡· ÔÂ‚Ó„Ó Í‡Ì‡Î‡ ‰Îˇ ÓÚÓ·‡ÊÂÌËˇ ÂÁÛÎ¸Ú‡Ú‡",
        "Takes scale for a mathematical signal from the first channel"
    },
    OnPress_Function_RangeA,
    Draw_Function_RangeA
};

static void OnPress_Function_RangeA(void)
{
    SET_RANGE_MATH = SET_RANGE_A;
    MATH_DIVIDER = SET_DIVIDER_A;
}

static void Draw_Function_RangeA(int x, int y)
{
    Painter_DrawChar(x + 8, y + 5, '1');
}

// —≈–¬»— - ‘”Õ ÷»ﬂ - Ã‡Ò¯Ú‡· 2-„Ó Í‡Ì‡Î‡ ------------------------------------------------------------------------------------------------------------
static const SButton bFunction_RangeB =
{
    Item_SmallButton, &ppFunction, 0,
    {
        "Ã‡Ò¯Ú‡· 2-„Ó Í‡Ì‡Î‡", "Scale of the 2nd channel",
        "»ÒÔÓÎ¸ÁÛÂÚ Ï‡Ò¯Ú‡· ‚ÚÓÓ„Ó Í‡Ì‡Î‡ ‰Îˇ ÓÚÓ·‡ÊÂÌËˇ ÂÁÛÎ¸Ú‡Ú‡",
        "Takes scale for a mathematical signal from the second channel"
    },
    OnPress_Function_RangeB,
    Draw_Function_RangeB
};

static void OnPress_Function_RangeB(void)
{
    SET_RANGE_MATH = SET_RANGE_B;
    MATH_DIVIDER = SET_DIVIDER_B;
}

static void Draw_Function_RangeB(int x, int y)
{
    Painter_DrawChar(x + 8, y + 5, '2');
}

// —≈–¬»— - ETHERNET /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page ppEthernet =
{
    Item_Page, &pService, 0,
    {
        "ETHERNET", "ETHERNET",
        "Õ‡ÒÚÓÈÍË ethernet",
        "Settings of ethernet"
    },
    Page_Service_Ethernet,
    {
        (void *)&cEthernet_Ethernet,    // —≈–¬»— - ETHERNET - Ethernet
        (void *)&ipEthernet_IP,         // —≈–¬»— - ETHERNET - IP ‡‰ÂÒ
        (void *)&ipEthernet_NetMask,    // —≈–¬»— - ETHERNET - Ã‡ÒÍ‡ ÔÓ‰ÒÂÚË
        (void *)&ipEthernet_Gateway,    // —≈–¬»— - ETHERNET - ÿÎ˛Á
        (void *)&ipEthernet_MAC         // —≈–¬»— - ETHERNET - MAC ‡‰ÂÒ
    }
};

// —≈–¬»— - ETHERNET - Ethernet ----------------------------------------------------------------------------------------------------------------------
static const Choice cEthernet_Ethernet =
{
    Item_Choice, &ppEthernet, 0,
    {
        "Ethernet",    "Ethernet"
        ,
    "◊ÚÓ·˚ Á‡‰ÂÈÒÚ‚Ó‚‡Ú¸ ethernet, ‚˚·ÂËÚÂ \"¬ÍÎ˛˜ÂÌÓ\" Ë ‚˚ÍÎ˛˜ËÚÂ ÔË·Ó.\n"
    "◊ÚÓ·˚ ÓÚÍÎ˛˜ËÚ¸ ethernet, ‚˚·ÂËÚÂ \"ŒÚÍÎ˛˜ÂÌÓ\" Ë ‚˚ÍÎ˛˜ËÚÂ ÔË·Ó."
    ,
    "To involve ethernet, choose \"Included\" and switch off the device.\n"
    "To disconnect ethernet, choose \"Disconnected\" and switch off the device."
    },
    {
        {"¬ÍÎ˛˜ÂÌÓ",    "Included"},
        {"ŒÚÍÎ˛˜ÂÌÓ",   "Disconnected"}
    },
    (int8 *)&ETH_ENABLED, OnChanged_Ethernet_Settings
};

static void OnChanged_Ethernet_Settings(bool active)
{
    Display_ShowWarning(NeedRebootDevice);
}

// —≈–¬»— - ETHERNET - IP ‡‰ÂÒ ----------------------------------------------------------------------------------------------------------------------
static const IPaddress ipEthernet_IP =
{
    Item_IP, &ppEthernet, 0,
    {
        "IP ‡‰ÂÒ", "IP-address",
        "”ÒÚ‡ÌÓ‚Í‡ IP ‡‰ÂÒ‡",
        "Set of IP-address"
    },
    &IP_ADDR0, &IP_ADDR1, &IP_ADDR2, &IP_ADDR3,
    OnChanged_Ethernet_Settings,
    &ETH_PORT
};

// —≈–¬»— - ETHERNET - Ã‡ÒÍ‡ ÔÓ‰ÒÂÚË -----------------------------------------------------------------------------------------------------------------
static const IPaddress ipEthernet_NetMask =
{
    Item_IP, &ppEthernet, 0,
    {
        "Ã‡ÒÍ‡ ÔÓ‰ÒÂÚË", "Network mask",
        "”ÒÚ‡ÌÓ‚Í‡ Ï‡ÒÍË ÔÓ‰ÒÂÚË",
        "Set of network mask"
    },
    &NETMASK_ADDR0, &NETMASK_ADDR1, &NETMASK_ADDR2, &NETMASK_ADDR3,
    OnChanged_Ethernet_Settings
};

// —≈–¬»— - ETHERNET - ÿÎ˛Á --------------------------------------------------------------------------------------------------------------------------
static const IPaddress ipEthernet_Gateway =
{
    Item_IP, &ppEthernet, 0,
    {
        "ÿÎ˛Á", "Gateway",
        "”ÒÚ‡ÌÓ‚Í‡ ‡‰ÂÒ‡ ÓÒÌÓ‚ÌÓ„Ó ¯Î˛Á‡",
        "Set of gateway address"
    },
    &GW_ADDR0, &GW_ADDR1, &GW_ADDR2, &GW_ADDR3,
    OnChanged_Ethernet_Settings
};

// —≈–¬»— - ETHERNET - MAC ‡‰ÂÒ ---------------------------------------------------------------------------------------------------------------------
static const MACaddress ipEthernet_MAC =
{
    Item_MAC, &ppEthernet, 0,
    {
        "MAC ‡‰ÂÒ", "MAC-address",
        "”ÒÚ‡ÌÓ‚Í‡ ÙËÁË˜ÂÒÍÓ„Ó ‡‰ÂÒ‡",
        "Set of MAC-address"
    },
    &set.eth_mac0, &set.eth_mac1, &set.eth_mac2, &set.eth_mac3, &set.eth_mac4, &set.eth_mac5,
    OnChanged_Ethernet_Settings
};

// —≈–¬»— - «¬”  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page ppSound =
{
    Item_Page, &pService, 0,
    {
        "«¬” ", "SOUND",
        "¬ ˝ÚÓÏ ÏÂÌ˛ ÏÓÊÌÓ Ì‡ÒÚÓËÚ¸ „ÓÏÍÓÒÚ¸ Á‚ÛÍ‡",
        "In this menu, you can adjust the volume"
    },
    Page_Service_Sound,
    {
        (void *)&cSound_Enable, // —≈–¬»— - «¬”  - «‚ÛÍ
        (void *)&gSound_Volume  // —≈–¬»— - «¬”  - √ÓÏÍÓÒÚ¸
    }

};

// —≈–¬»— - «¬”  - «‚ÛÍ ------------------------------------------------------------------------------------------------------------------------------
static const Choice cSound_Enable =
{
    Item_Choice, &ppSound, 0,
    {
        "«‚ÛÍ", "Sound",
        "¬ÍÎ˛˜ÂÌËÂ/‚˚ÍÎ˛˜ÂÌËÂ Á‚ÛÍ‡",
        "Inclusion/switching off of a sound"
    },
    {
        {DISABLE_RU, DISABLE_EN},
        {ENABLE_RU, ENABLE_EN}
    },
    (int8 *)&SOUND_ENABLED
};

// —≈–¬»— - «¬”  - √ÓÏÍÓÒÚ¸ -------------------------------------------------------------------------------------------------------------------------
static const Governor gSound_Volume =
{
    Item_Governor, &ppSound, 0,
    {
        "√ÓÏÍÓÒÚ¸", "Volume",
        "”ÒÚ‡ÌÓ‚Í‡ „ÓÏÍÓÒÚË Á‚ÛÍ‡",
        "Set the volume"
    },
    &SOUND_VOLUME, 0, 100
};


// —≈–¬»— - ¬–≈Ãﬂ ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page ppRTC =
{
    Item_Page, &pService, 0,
    {
        "¬–≈Ãﬂ", "TIME",
        "”ÒÚ‡ÌÓ‚Í‡ Ë Ì‡ÒÚÓÈÍ‡ ‚ÂÏÂÌË",
        "Set and setup time"
    },
    Page_Service_RTC,
    {
        (void *)&tRTC_Time,         // —≈–¬»— - ¬–≈Ãﬂ - ¬ÂÏˇ
        (void *)&tRTC_Correction    // C≈–¬»— - ¬–≈Ãﬂ -  ÓÂÍˆËˇ
    }
};

// —≈–¬»— - ¬–≈Ãﬂ - ¬ÂÏˇ ----------------------------------------------------------------------------------------------------------------------------
static int8 dServicetime = 0;
static int8 hours = 0, minutes = 0, secondes = 0, year = 0, month = 0, day = 0;
static const Time tRTC_Time =
{
    Item_Time, &ppRTC, 0,
    {
        "¬ÂÏˇ", "Time"
        ,
        "”ÒÚ‡ÌÓ‚Í‡ ÚÂÍÛ˘Â„Ó ‚ÂÏÂÌË.\nœÓˇ‰ÓÍ ‡·ÓÚ˚:\n"
        "Õ‡Ê‡Ú¸ Ì‡ ˝ÎÂÏÂÌÚ ÏÂÌ˛ \"¬ÂÏˇ\". ŒÚÍÓÂÚÒˇ ÏÂÌ˛ ÛÒÚ‡ÌÓ‚ÍË ÚÂÍÛ˘Â„Ó ‚ÂÏÂÌË.  ÓÓÚÍËÏË Ì‡Ê‡ÚËˇÏË ÍÌÓÔÍË Ì‡ ˆËÙÓ‚ÓÈ ÍÎ‡‚Ë‡ÚÛÂ, ÒÓÓÚ‚ÂÚÒ‚Û˛˘ÂÈ "
        "˝ÎÂÏÂÌÚÛ ÛÔ‡‚ÎÂÌËˇ \"¬ÂÏˇ\", ‚˚‰ÂÎËÚ¸ ˜‡Ò˚, ÏËÌÛÚ˚, ÒÂÍÛÌ‰˚, „Ó‰, ÏÂÒˇˆ, ËÎË ˜ËÒÎÓ. ¬˚‰ÂÎÂÌÌ˚È ˝ÎÂÏÂÌÚ Ó·ÓÁÌ‡˜‡ÂÚÒˇ ÏË„‡˛˘ÂÈ Ó·Î‡ÒÚ¸˛. "
        "¬‡˘ÂÌËÂÏ Û˜ÍË ”—“¿ÕŒ¬ ¿ ÛÒÚ‡ÌÓ‚ËÚ¸ ÌÂÓ·ıÓ‰ËÏÓÂ ÁÌ‡˜ÂÌËÂ. «‡ÚÂÏ ‚˚‰ÂÎËÚ¸ ÔÛÌÍÚ \"—Óı‡ÌËÚ¸\", Ì‡Ê‡Ú¸ Ë Û‰ÂÊË‚‡Ú¸ ·ÓÎÂÂ 0.5 ÒÂÍ ÍÌÓÔÍÛ Ì‡ Ô‡ÌÂÎË "
        "ÛÔ‡‚ÎÂÌËˇ. ÃÂÌ˛ ÛÒÚ‡ÌÓ‚ÍË ÚÂÍÛ˘Â„Ó ‚ÂÏÂÌˇ Á‡ÍÓÂÚÒˇ Ò ÒÓı‡ÌÂÌËÂÏ ÌÓ‚Ó„Ó ÚÂÍÛ˘Â„Ó ‚ÂÏÂÌË. Õ‡Ê‡ÚËÂ ‰ÎËÚÂÎ¸ÌÓÂ Û‰ÂÊ‡ÌËÂ ÍÌÓÔÍË Ì‡ Î˛·ÓÏ ‰Û„ÓÏ ˝ÎÂÏÂÌÚÂ "
        "ÔË‚Â‰∏Ú Í Á‡Í˚ÚË˛ ÏÂÌ˛ ÛÒÚ‡ÌÓ‚ÍË ÚÂÍÛ˘Â„Ó ‚Â    ÏÂÌË ·ÂÁ ÒÓı‡ÌÂÌËˇ ÌÓ‚Ó„Ó ÚÂÍÛ˘Â„Ó ‚ÂÏÂÌË"
        ,
        "Setting the current time. \nPoryadok work:\n"
        "Click on the menu item \"Time\".The menu set the current time.By briefly pressing the button on the numeric keypad of conformity "
        "Control \"Time\", highlight the hours, minutes, seconds, year, month, or a number.The selected item is indicated by a flashing area. "
        "Turn the setting knob to set the desired value. Then highlight \"Save\", press and udrezhivat more than 0.5 seconds, the button on the panel "
        "Control. Menu Setting the current time will be closed to the conservation of the new current time. Pressing a button on the prolonged retention of any other element "
        "will lead to the closure of the current time setting menu without saving the new current time"
    },
    &dServicetime, &hours, &minutes, &secondes, &month, &day, &year
};

// —≈–¬»— - ¬–≈Ãﬂ -  ÓÂÍˆËˇ ------------------------------------------------------------------------------------------------------------------------
static const Governor tRTC_Correction =
{
    Item_Governor, &ppRTC, 0,
    {
        " ÓÂÍˆËˇ", "Correction",
        "”ÒÚ‡ÌÓ‚Í‡ ÍÓÂÍÚËÛ˛˘Â„Ó ÍÓ˝ÙÙËˆËÂÌÚ‡ ‰Îˇ ÍÓÏÔÂÌÒ‡ˆËË ıÓ‰‡ ‚ÂÏÂÌË",
        "Setting correction factor to compensate for time travel"
    },
    &NRST_CORRECTION_TIME, -63, 63, OnChanged_Time_Correction
};

static void OnChanged_Time_Correction(void)
{
    RTC_SetCorrection((int8)NRST_CORRECTION_TIME);
}

// —≈–¬»— - ﬂÁ˚Í -------------------------------------------------------------------------------------------------------------------------------------
static const Choice cLanguage =
{
    Item_Choice, &pService, 0,
    {
        "ﬂÁ˚Í",         "Language",
        "œÓÁ‚ÓÎˇÂÚ ‚˚·‡Ú¸ ˇÁ˚Í ÏÂÌ˛",
        "Allows you to select the menu language"
    },
    {
        {"–ÛÒÒÍËÈ",     "Russian"},
        {"¿Ì„ÎËÈÒÍËÈ",  "English"}
    },
    (int8 *)&LANG
};


// —≈–¬»— - »Õ‘Œ–Ã¿÷»ﬂ ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
static const Page ppInformation =
{
    Item_Page, &pService, 0,
    {
        "»Õ‘Œ–Ã¿÷»ﬂ", "INFORMATION",
        "œÓÍ‡Á˚‚‡ÂÚ ËÌÙÓÏ‡ˆË˛ Ó ÔË·ÓÂ",
        "Displays information about the device"
    },
    PageSB_Service_Information,
    {
        (void *)&bInformation_Exit, // —≈–¬»— - »Õ‘Œ–Ã¿÷»ﬂ - ¬˚ıÓ‰
        (void *)0,
        (void *)0,
        (void *)0,
        (void *)0,
        (void *)0
    },
    true, OnPress_Information
};

static void OnPress_Information(void)
{
    Display_SetDrawMode(DrawMode_Auto, Information_Draw);
}

static void Information_Draw(void)
{
    Painter_BeginScene(gColorBack);
    int x = 100;
    int dY = 20;
    int y = 20;
    Painter_DrawRectangleC(0, 0, 319, 239, gColorFill);
    y += dY;
    Painter_DrawText(x, y, DICT(DInformation));
    y += dY;
    
    char buffer[100];

    sprintf(buffer, "%s : %s", DICT(DModel), LANG_RU ? MODEL_RU : MODEL_EN);
    Painter_DrawText(x, y, buffer);

    y += 2 * dY;

    Painter_DrawText(x, y, DICT(DSoftware));
    y += dY;
    sprintf(buffer, (const char *)DICT(DVersion), NUM_VER);
    Painter_DrawText(x, y, buffer);
    y += dY;

    Painter_DrawFormText(x, y, gColorFill, "CRC32 : %X", Hardware_CalculateCRC32());

    dY = -10;
    Painter_DrawStringInCenterRect(0, 190 + dY, 320, 20, "ƒÎˇ ÔÓÎÛ˜ÂÌËˇ ÔÓÏÓ˘Ë Ì‡ÊÏËÚÂ Ë Û‰ÂÊË‚‡ÈÚÂ ÍÌÓÔÍÛ œŒÃŒŸ‹");
#ifdef S8_54
    Painter_DrawStringInCenterRect(0, 205 + dY, 320, 20, "ŒÚ‰ÂÎ Ï‡ÍÂÚËÌ„‡: ÚÂÎ./Ù‡ÍÒ. 8-017-262-57-50");
    Painter_DrawStringInCenterRect(0, 220 + dY, 320, 20, "–‡Á‡·ÓÚ˜ËÍË: e-mail: mnipi-24(@)tut.by, ÚÂÎ. 8-017-262-57-51");
#endif

    Menu_Draw();
    Painter_EndScene();
}

// —≈–¬»— - »Õ‘Œ–Ã¿÷»ﬂ - ¬˚ıÓ‰ -----------------------------------------------------------------------------------------------------------------------
static const SButton bInformation_Exit =
{
    Item_SmallButton, &ppInformation,
    COMMON_BEGIN_SB_EXIT,
    OnPress_Information_Exit,
    DrawSB_Exit
};

static void OnPress_Information_Exit(void)
{
    Display_SetDrawMode(DrawMode_Auto, 0);
}







































/*
//----------------------------------------------------------------------------------------------------------------------------------------------------
void OnPressPrevSettings(void)
{

}

//----------------------------------------------------------------------------------------------------------------------------------------------------
void OnChangedColorMenuTitle(void)
{
    uint16 newColor1 = Painter_ReduceBrightness(COLOR(COLOR_MENU_TITLE), 0.50f);
    uint16 newColor2 = Painter_ReduceBrightness(COLOR(COLOR_MENU_TITLE), 1.50f);
    COLOR(COLOR_MENU_TITLE_DARK) = newColor1;
    COLOR(COLOR_MENU_TITLE_BRIGHT) = newColor2;
    Color_Log(COLOR_MENU_TITLE);
    Color_Log(COLOR_MENU_TITLE_DARK);
    Color_Log(COLOR_MENU_TITLE_BRIGHT);
}

//----------------------------------------------------------------------------------------------------------------------------------------------------
void OnChangedColorMenu2Item(void)
{
    uint16 newColor1 = Painter_ReduceBrightness(COLOR(COLOR_MENU_ITEM), 0.50f);
    uint16 newColor2 = Painter_ReduceBrightness(COLOR(COLOR_MENU_ITEM), 1.50f);
    COLOR(COLOR_MENU_ITEM_DARK) = newColor1;
    COLOR(COLOR_MENU_ITEM_BRIGHT) = newColor2;
    Color_Log(COLOR_MENU_ITEM);
    Color_Log(COLOR_MENU_ITEM_DARK);
    Color_Log(COLOR_MENU_ITEM_BRIGHT);
}


// —≈–¬»— ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
extern const Page pService;

// —≈–¬»— - ŒÚÍ‡Ú Ì‡ÒÚÓÂÍ
const Button mbServicePreviousSettings =
{
    Item_Button, &pService, 0,
    {
        "ŒÚÍ‡Ú Ì‡ÒÚÓÂÍ", "Return settings",
        "¬ÓÁ‚‡˘‡ÂÚ Ì‡ÒÚÓÈÍË ÓÒˆËÎÎÓ„‡Ù‡, ÍÓÚÓ˚Â ·˚ÎË ‚ ÏÓÏÂÌÚ Ì‡Ê‡ÚËˇ \"œÓËÒÍ ÒË„Ì‡Î‡\"",
        "Returns the oscilloscope settings that were in when you press \"Searching for signal\""
    },
    OnPressPrevSettings
};

static bool ActiveF_MathFormula(void)
{
    return MATH_FUNC_MUL || MATH_FUNC_SUM;
}

static void ChangeF_MathFormula(void)
{

}

static int8 curDigit = 0;
const Formula mfMathFormula =
{
    Item_Formula, &ppFunction, ActiveF_MathFormula,
    {
        "‘ÓÏÛÎ‡", "Formulf",
        "«‰ÂÒ¸ Á‡‰‡˛ÚÒˇ ÍÓ˝ÙÙËˆËÂÌÚ˚ Ë ÁÌ‡ÍË ‚ Ï‡ÚÂÏ‡ÚË˜ÂÒÍÓÈ ÙÓÏÛÎÂ",
        "Here you can set the coefficients and signs in a mathematical formula"
    },
    (int8 *)&MATH_FUNC, (int8 *)&set.math_koeff1add, (int8 *)&set.math_koeff2add, (int8 *)&set.math_koeff1mul, (int8 *)&set.math_koeff2mul, &curDigit, ChangeF_MathFormula
};
*/
